<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Help Portal</title>
    <style>
        /* Basic styles for the layout */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 1em;
        }
        #login-section {
            display: block;
            text-align: center;
            margin: 2em;
        }
        #login-form input {
            margin: 0.5em;
            padding: 0.5em;
            width: 200px;
        }
        #login-form button {
            padding: 0.5em 2em;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #main-content {
            display: none;
            text-align: center;
            padding: 2em;
        }
        footer {
            text-align: center;
            padding: 1em;
            background-color: #4CAF50;
            color: white;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Student Help Portal</h1>
        <p>Your go-to platform for assignments and resources</p>
    </header>

    <div id="login-section">
        <h2>Login</h2>
        <form id="login-form">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
    </div>

    <div id="welcome-message">
        <h2>Welcome!</h2>
        <p>You are now logged in as <span id="user-role"></span>.</p>
    </div>

    <main style="display: none;" id="main-content">
        <section id="tasks">
            <h2>Current Tasks</h2>
            <input type="text" id="search-task" placeholder="Search tasks..." oninput="filterTasks()">
            <ul id="task-list">
                <!-- Tasks will be populated here dynamically -->
            </ul>
        </section>

        <section id="add-task">
            <h2>Add a New Task</h2>
            <form id="task-form">
                <label for="task-name">Task Name:</label>
                <input type="text" id="task-name" placeholder="Enter task name" required>

                <label for="task-deadline">Deadline (Optional):</label>
                <input type="datetime-local" id="task-deadline">

                <label for="task-duration">Duration (Optional, No End Date):</label>
                <input type="checkbox" id="task-duration"> No End Date

                <button type="submit">Add Task</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Student Help Portal. All rights reserved.</p>
    </footer>

    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js"></script>

    <!-- Link to Firebase config file -->
    <script src="firebase-config.js"></script>

    <script>
        // Handle login
        const users = [
            { username: 'admin', password: 'ghanighanizoro', role: 'admin' },
            { username: 'student', password: 'abcd', role: 'user' }
        ];

        const loginForm = document.getElementById('login-form');
        const loginSection = document.getElementById('login-section');
        const mainContent = document.getElementById('main-content');
        const welcomeMessage = document.getElementById('welcome-message');
        const userRoleSpan = document.getElementById('user-role');
        const taskForm = document.getElementById('task-form');
        const addTaskSection = document.getElementById('add-task');
        const taskList = document.getElementById('task-list');
        const searchInput = document.getElementById('search-task');

        let isAdmin = false;

        // Login event listener
        loginForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = users.find(user => user.username === username && user.password === password);

            if (user) {
                isAdmin = user.role === 'admin';
                userRoleSpan.textContent = isAdmin ? 'Admin' : 'User';

                loginSection.style.display = 'none';
                welcomeMessage.style.display = 'block';
                mainContent.style.display = 'block';

                if (!isAdmin) {
                    addTaskSection.style.display = 'none';
                }

                loadTasksFromFirebase();
            } else {
                alert('Invalid credentials');
            }
        });

        // Submit new task
        taskForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const taskName = document.getElementById('task-name').value;
            const taskDeadline = document.getElementById('task-deadline').value;
            const hasNoEndDate = document.getElementById('task-duration').checked;

            const task = {
                name: taskName,
                deadline: taskDeadline || 'No deadline',
                hasNoEndDate: hasNoEndDate,
                comments: []
            };

            // Save task to Firebase
            const tasksRef = database.ref('tasks');
            tasksRef.push(task, (error) => {
                if (error) {
                    alert('Failed to add task');
                } else {
                    alert('Task added successfully!');
                    loadTasksFromFirebase();
                }
            });
        });

        // Load tasks from Firebase
        function loadTasksFromFirebase() {
            const tasksRef = database.ref('tasks');

            tasksRef.once('value', (snapshot) => {
                const tasks = snapshot.val();
                taskList.innerHTML = '';

                if (tasks) {
                    Object.keys(tasks).forEach((taskId) => {
                        const task = tasks[taskId];
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span>Task: ${task.name}</span><br>
                            <em>Deadline: ${task.deadline}</em><br>
                            <span class="countdown" id="countdown-${taskId}"></span><br>
                            <button onclick="removeTask('${taskId}')">Remove</button>
                        `;

                        // Add comment section
                        const commentSection = document.createElement('div');
                        commentSection.classList.add('comments');
                        
                        if (isAdmin) {
                            commentSection.innerHTML = `
                                <form onsubmit="addComment(event, '${taskId}')">
                                    <input type="text" id="comment-input-${taskId}" placeholder="Add a comment">
                                    <button type="submit">Add Comment</button>
                                </form>
                            `;
                        } else {
                            const existingComment = task.comments[0] ? task.comments[0] : 'No comments yet.';
                            commentSection.innerHTML = `
                                <p>${existingComment}</p>
                            `;
                        }

                        li.appendChild(commentSection);
                        taskList.appendChild(li);
                    });
                }
            });
        }

        // Add a comment to a task
        function addComment(e, taskId) {
            e.preventDefault();
            const commentInput = document.getElementById(`comment-input-${taskId}`);
            const comment = commentInput.value;

            if (!comment) {
                alert('Comment cannot be empty.');
                return;
            }

            const taskRef = database.ref('tasks/' + taskId);
            taskRef.update({
                comments: [comment]
            }, (error) => {
                if (error) {
                    alert('Failed to add comment');
                } else {
                    loadTasksFromFirebase();
                }
            });
        }

        // Remove task
        function removeTask(taskId) {
            const taskRef = database.ref('tasks/' + taskId);
            taskRef.remove()
                .then(() => {
                    loadTasksFromFirebase();
                })
                .catch((error) => {
                    alert('Failed to remove task');
                });
        }

        // Filter tasks
        function filterTasks() {
            const query = searchInput.value.toLowerCase();
            loadTasksFromFirebase(query);
        }
    </script>
</body>
    </html>
